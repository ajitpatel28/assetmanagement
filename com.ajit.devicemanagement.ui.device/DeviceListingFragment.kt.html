<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeviceListingFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DeviceViewModelTest (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.ajit.devicemanagement.ui.device</a> &gt; <span class="el_source">DeviceListingFragment.kt</span></div><h1>DeviceListingFragment.kt</h1><pre class="source lang-java linenums">package com.ajit.devicemanagement.ui.device

import com.ajit.devicemanagement.data.provider.DataSyncManager
import android.content.Context
import android.content.IntentFilter
import android.net.ConnectivityManager
import android.os.Bundle
import android.util.Log
import androidx.fragment.app.Fragment
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.view.WindowManager
import android.view.inputmethod.InputMethodManager
import androidx.activity.addCallback
import androidx.appcompat.widget.SearchView
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.ajit.devicemanagement.R
import com.ajit.devicemanagement.databinding.FragmentDeviceListingBinding
import com.ajit.devicemanagement.util.*
import dagger.hilt.android.AndroidEntryPoint
import java.util.*


@AndroidEntryPoint
<span class="nc" id="L28">class DeviceListingFragment : Fragment() {</span>

<span class="nc" id="L30">    private val TAG = &quot;DeviceListingFragment&quot;</span>
    private lateinit var binding: FragmentDeviceListingBinding
<span class="nc" id="L32">    private val viewModel: DeviceViewModel by viewModels()</span>
    private lateinit var dataSyncManager: DataSyncManager
    private lateinit var searchView: SearchView
<span class="nc" id="L35">    private val networkChangeReceiver = NetworkChangeReceiver()</span>
<span class="nc" id="L36">    private val adapter by lazy {</span>
<span class="nc" id="L37">        DeviceListingAdapter(</span>
<span class="nc" id="L38">            onItemClicked = { pos, item -&gt;</span>
<span class="nc" id="L39">                findNavController().navigate(</span>
<span class="nc" id="L40">                    R.id.action_deviceListingFragment_to_deviceDetailFragment,</span>
<span class="nc" id="L41">                    Bundle().apply {</span>
<span class="nc" id="L42">                        putParcelable(&quot;device&quot;, item)</span>
<span class="nc" id="L43">                    }</span>
                )
<span class="nc" id="L45">            }</span>
        )
    }


    override fun onAttach(context: Context) {
<span class="nc" id="L51">        super.onAttach(context)</span>
<span class="nc" id="L52">        dataSyncManager = DataSyncManager(requireContext())</span>
<span class="nc" id="L53">    }</span>

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
<span class="nc" id="L59">        binding = FragmentDeviceListingBinding.inflate(layoutInflater)</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">       return binding.root</span>
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L64">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc" id="L65">        requireContext().registerReceiver(networkChangeReceiver, IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION))</span>

//        dataSyncManager.startSync()

<span class="nc" id="L69">        loadData()</span>

<span class="nc" id="L71">        requireActivity().onBackPressedDispatcher.addCallback(viewLifecycleOwner) {</span>
<span class="nc" id="L72">            findNavController().navigate(R.id.action_deviceListingFragment_to_homeFragment)</span>
<span class="nc" id="L73">        }</span>



<span class="nc bnc" id="L77" title="All 2 branches missed.">        binding.homeBtn.setOnClickListener {</span>
<span class="nc" id="L78">            findNavController().navigate(R.id.action_deviceListingFragment_to_homeFragment)</span>
<span class="nc" id="L79">        }</span>



<span class="nc bnc" id="L83" title="All 2 branches missed.">        binding.recyclerView.layoutManager = LinearLayoutManager(requireContext())</span>


<span class="nc bnc" id="L86" title="All 2 branches missed.">        binding.recyclerView.adapter = adapter</span>

<span class="nc bnc" id="L88" title="All 2 branches missed.">        binding.addDeviceButton.setOnClickListener {</span>
<span class="nc" id="L89">            findNavController().navigate(</span>
<span class="nc" id="L90">                R.id.action_deviceListingFragment_to_addNewDeviceFragment,</span>
<span class="nc" id="L91">                Bundle().apply {</span>
<span class="nc" id="L92">                    putString(&quot;type&quot;, &quot;create&quot;)</span>
<span class="nc" id="L93">                }</span>
            )
<span class="nc" id="L95">        }</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">        searchView = binding.searchView</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">        val query = arguments?.getString(&quot;searchQuery&quot;)</span>
<span class="nc bnc" id="L99" title="All 6 branches missed.">        if (!query.isNullOrEmpty()) {</span>
<span class="nc" id="L100">            Log.e(TAG,&quot;$query&quot;)</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">            searchView.setQuery(query, false)</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">            searchView.requestFocus()</span>
<span class="nc" id="L103">            val imm = requireContext().getSystemService(Context.INPUT_METHOD_SERVICE) as InputMethodManager</span>
<span class="nc bnc" id="L104" title="All 2 branches missed.">            imm.showSoftInput(searchView.findFocus(), InputMethodManager.SHOW_IMPLICIT)</span>
<span class="nc" id="L105">            filterList(query)</span>
        }

<span class="nc bnc" id="L108" title="All 2 branches missed.">        searchView.setOnQueryTextFocusChangeListener { _, hasFocus -&gt;</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">            if (hasFocus) {</span>
<span class="nc" id="L110">                val imm = requireContext().getSystemService(Context.INPUT_METHOD_SERVICE) as InputMethodManager</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">                imm.showSoftInput(searchView.findFocus(), InputMethodManager.SHOW_IMPLICIT)</span>
            }
<span class="nc" id="L113">        }</span>

<span class="nc bnc" id="L115" title="All 2 branches missed.">        searchView.setOnQueryTextListener(object : SearchView.OnQueryTextListener {</span>
            override fun onQueryTextSubmit(query: String?): Boolean {
<span class="nc" id="L117">                return false</span>
            }

            override fun onQueryTextChange(newText: String?): Boolean {
<span class="nc" id="L121">                filterList(newText)</span>
<span class="nc" id="L122">                return true</span>
            }

        })

<span class="nc" id="L127">        }</span>


    private fun loadData(){
<span class="nc" id="L131">        viewModel.getDevices()</span>
<span class="nc" id="L132">        viewModel.devices.observe(viewLifecycleOwner) { state -&gt;</span>
<span class="nc" id="L133">            when (state) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                is UiState.Loading -&gt; {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">                    binding.progressBar.show()</span>
                }
<span class="nc bnc" id="L137" title="All 2 branches missed.">                is UiState.Failure -&gt; {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">                    binding.progressBar.hide()</span>
<span class="nc" id="L139">                    toast(state.error)</span>
                }
<span class="nc bnc" id="L141" title="All 2 branches missed.">                is UiState.Success -&gt; {</span>
<span class="nc bnc" id="L142" title="All 2 branches missed.">                    binding.progressBar.hide()</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                    if (state.data.isEmpty()) {</span>
                        // Show the empty list layout if the list is empty
<span class="nc bnc" id="L145" title="All 2 branches missed.">                        binding.noDevicesFound.visibility = View.VISIBLE</span>
<span class="nc" id="L146">                        adapter.updateList(state.data.toMutableList())</span>
                    } else {
                        // Hide the empty list layout if the list is not empty
<span class="nc bnc" id="L149" title="All 2 branches missed.">                        binding.noDevicesFound.visibility = View.GONE</span>
<span class="nc" id="L150">                        adapter.updateList(state.data.toMutableList())</span>
                    }
//                    adapter.updateList(state.data.toMutableList())
//                    adapter.updateList(state.data.toMutableList())
                }
                else -&gt; {}
            }
<span class="nc" id="L157">        }</span>
<span class="nc" id="L158">    }</span>

    private fun filterList(query: String?) {
<span class="nc" id="L161">        val deviceListState = viewModel.devices.value</span>
<span class="nc bnc" id="L162" title="All 4 branches missed.">        if (query != null &amp;&amp; deviceListState is UiState.Success) {</span>
<span class="nc" id="L163">            val deviceList = deviceListState.data</span>
<span class="nc" id="L164">            val filteredList = deviceList.filter { item -&gt;</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                item.deviceName.lowercase(Locale.ROOT).contains(query.lowercase(Locale.ROOT)) ||</span>
<span class="nc bnc" id="L166" title="All 2 branches missed.">                        item.deviceType.lowercase(Locale.ROOT).contains(query.lowercase(Locale.ROOT)) ||</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">                        item.deviceId.lowercase(Locale.ROOT).contains(query.lowercase(Locale.ROOT))</span>
            }

<span class="nc bnc" id="L170" title="All 4 branches missed.">            if (filteredList.isNullOrEmpty()) {</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                binding.noDevicesFound.visibility = View.VISIBLE</span>
<span class="nc" id="L172">                adapter.updateList(mutableListOf())</span>
<span class="nc" id="L173">                toast(&quot;No Data found&quot;)</span>
            } else {
<span class="nc bnc" id="L175" title="All 2 branches missed.">                binding.noDevicesFound.visibility = View.GONE</span>
<span class="nc" id="L176">                adapter.updateList(filteredList.toMutableList())</span>
            }
        } else {
<span class="nc bnc" id="L179" title="All 2 branches missed.">            binding.noDevicesFound.visibility = View.GONE</span>
<span class="nc" id="L180">            adapter.updateList(mutableListOf()) // Clear the adapter when the search query is null or the device list state is not success</span>
        }
<span class="nc" id="L182">    }</span>


    override fun onDestroyView() {
<span class="nc" id="L186">        super.onDestroyView()</span>

        // Unregister the network change receiver
<span class="nc" id="L189">        requireContext().unregisterReceiver(networkChangeReceiver)</span>
<span class="nc" id="L190">    }</span>

    override fun onResume() {
<span class="nc" id="L193">        super.onResume()</span>

<span class="nc bnc" id="L195" title="All 4 branches missed.">        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_NOTHING)</span>

<span class="nc" id="L197">        loadData()</span>
<span class="nc" id="L198">    }</span>

    override fun onPause() {
<span class="nc" id="L201">        super.onPause()</span>

        // Restore the original soft input mode when the fragment is paused
<span class="nc bnc" id="L204" title="All 4 branches missed.">        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE)</span>
<span class="nc" id="L205">    }</span>

}







</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>