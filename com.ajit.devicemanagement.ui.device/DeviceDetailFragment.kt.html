<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeviceDetailFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DeviceViewModelTest (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.ajit.devicemanagement.ui.device</a> &gt; <span class="el_source">DeviceDetailFragment.kt</span></div><h1>DeviceDetailFragment.kt</h1><pre class="source lang-java linenums">package com.ajit.devicemanagement.ui.device

import android.annotation.SuppressLint
import android.content.Context
import android.graphics.Rect
import android.os.Bundle
import android.util.Log
import androidx.fragment.app.Fragment
import android.view.LayoutInflater
import android.view.MotionEvent
import android.view.View
import android.view.ViewGroup
import android.view.animation.Animation
import android.view.animation.AnimationUtils
import androidx.activity.OnBackPressedCallback
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import com.ajit.devicemanagement.R
import com.ajit.devicemanagement.data.model.RoomDevice
import com.ajit.devicemanagement.databinding.FragmentDeviceDetailBinding
import com.ajit.devicemanagement.util.UiState
import com.ajit.devicemanagement.util.toast
import dagger.hilt.android.AndroidEntryPoint
import java.text.DateFormat
import java.text.SimpleDateFormat
import java.util.*


@AndroidEntryPoint
<span class="nc" id="L30">class DeviceDetailFragment : Fragment() {</span>

<span class="nc" id="L32">    val TAG = &quot;DeviceDetailFragment&quot;</span>
<span class="nc bnc" id="L33" title="All 2 branches missed.">    lateinit var binding: FragmentDeviceDetailBinding</span>
<span class="nc" id="L34">    val viewModel: DeviceViewModel by viewModels()</span>
    private var isExpanded = false

<span class="nc" id="L37">    private val fromBottomFabAnim: Animation by lazy {</span>
<span class="nc" id="L38">        AnimationUtils.loadAnimation(context, R.anim.from_bottom_fab)</span>
    }
<span class="nc" id="L40">    private val toBottomFabAnim: Animation by lazy {</span>
<span class="nc" id="L41">        AnimationUtils.loadAnimation(context, R.anim.to_bottom_fab)</span>
    }
<span class="nc" id="L43">    private val rotateAntiClockWiseFabAnim: Animation by lazy {</span>
<span class="nc" id="L44">        AnimationUtils.loadAnimation(context, R.anim.rotate_anti_clock_wise)</span>
    }
<span class="nc" id="L46">    private val sdf = SimpleDateFormat(&quot;dd MMM yyyy&quot;)</span>
//    private val sdf = DateFormat.getDateInstance(DateFormat.MEDIUM)






    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        // Inflate the layout for this fragment
<span class="nc" id="L59">        binding = FragmentDeviceDetailBinding.inflate(layoutInflater)</span>
<span class="nc" id="L60">        return binding.root</span>
    }

    @SuppressLint(&quot;ClickableViewAccessibility&quot;)
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L65">        super.onViewCreated(view, savedInstanceState)</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">        val device = arguments?.getParcelable&lt;RoomDevice&gt;(&quot;device&quot;)</span>

<span class="nc" id="L68">        requireActivity().onBackPressedDispatcher.addCallback(viewLifecycleOwner, object : OnBackPressedCallback(true) {</span>
            override fun handleOnBackPressed() {
<span class="nc bnc" id="L70" title="All 2 branches missed.">                if (isExpanded) {</span>
<span class="nc" id="L71">                    shrinkFab()</span>
                } else {
<span class="nc" id="L73">                    isEnabled = false // Disable this callback</span>
<span class="nc bnc" id="L74" title="All 2 branches missed.">                    val currentDestination = findNavController().currentDestination?.id</span>

<span class="nc bnc" id="L76" title="All 4 branches missed.">                    if (currentDestination == R.id.deviceDetailFragment) {</span>
<span class="nc" id="L77">                        findNavController().navigateUp()</span>
                    }
                }
<span class="nc" id="L80">            }</span>
        })

<span class="nc bnc" id="L83" title="All 2 branches missed.">        device?.let {</span>
<span class="nc" id="L84">            displayDeviceDetails(it)</span>
<span class="nc" id="L85">        }</span>


<span class="nc" id="L88">        binding.addDeviceButton.setOnClickListener {</span>
<span class="nc" id="L89">            findNavController().navigate(R.id.action_deviceDetailFragment_to_addNewDeviceFragment)</span>
<span class="nc" id="L90">        }</span>

<span class="nc" id="L92">        binding.homeBtn.setOnClickListener {</span>
<span class="nc" id="L93">            findNavController().navigate(R.id.action_deviceDetailFragment_to_homeFragment)</span>
<span class="nc" id="L94">        }</span>

<span class="nc" id="L96">        binding.myDevices.setOnClickListener {</span>
<span class="nc" id="L97">            findNavController().navigate(R.id.action_deviceDetailFragment_to_deviceListingFragment)</span>

<span class="nc" id="L99">        }</span>

<span class="nc" id="L101">        binding.deviceDetailBack.setOnClickListener {</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">            activity?.onBackPressed()</span>
<span class="nc" id="L103">        }</span>

<span class="nc" id="L105">        binding.deviceDetailEditBtn.setOnClickListener {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">            device?.let {</span>
<span class="nc" id="L107">                val bundle = Bundle().apply {</span>
<span class="nc" id="L108">                    putParcelable(&quot;device&quot;, it)</span>
<span class="nc" id="L109">                }</span>
<span class="nc" id="L110">                findNavController().navigate(</span>
<span class="nc" id="L111">                    R.id.action_deviceDetailFragment_to_addNewDeviceFragment,</span>
<span class="nc" id="L112">                    bundle</span>
                )
<span class="nc" id="L114">            }</span>
<span class="nc" id="L115">        }</span>

<span class="nc" id="L117">        binding.deviceDetailDeleteBtn.setOnClickListener {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">            device?.let {</span>
<span class="nc" id="L119">                viewModel.deleteDevice(it)</span>
<span class="nc" id="L120">                Log.e(TAG, &quot;device deleted&quot;)</span>
<span class="nc" id="L121">            }</span>
<span class="nc" id="L122">        }</span>


<span class="nc" id="L125">        binding.mainFabBtn.setOnTouchListener { v, event -&gt;</span>
<span class="nc" id="L126">            when (event.action) {</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">                MotionEvent.ACTION_DOWN -&gt; {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    if (!isExpanded) {</span>
<span class="nc" id="L129">                        expandFab()</span>
                    } else {
<span class="nc" id="L131">                        val outRect = Rect()</span>
<span class="nc" id="L132">                        binding.deviceDetailEditBtn.getGlobalVisibleRect(outRect)</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                        if (!outRect.contains(event.rawX.toInt(), event.rawY.toInt())) {</span>
<span class="nc" id="L134">                            shrinkFab()</span>
                        }
                    }
                }
            }
<span class="nc" id="L139">            false // Return false to allow other touch events to be handled</span>
        }


<span class="nc" id="L143">        viewModel.deleteDevice.observe(viewLifecycleOwner) { state -&gt;</span>
<span class="nc" id="L144">            when (state) {</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                is UiState.Loading -&gt; {</span>
                }
<span class="nc bnc" id="L147" title="All 2 branches missed.">                is UiState.Failure -&gt; {</span>
<span class="nc" id="L148">                    toast(state.error)</span>
                }
<span class="nc bnc" id="L150" title="All 2 branches missed.">                is UiState.Success -&gt; {</span>
<span class="nc" id="L151">                    toast(&quot;Device has been deleted&quot;)</span>
<span class="nc" id="L152">                    findNavController().navigate(R.id.action_deviceDetailFragment_to_deviceListingFragment)</span>
                }
            }
<span class="nc" id="L155">        }</span>
<span class="nc" id="L156">    }</span>



    private fun displayDeviceDetails(device: RoomDevice) {
<span class="nc" id="L161">        with(binding) {</span>
<span class="nc" id="L162">            date.text = sdf.format(Date(device.date))</span>
<span class="nc" id="L163">            deviceDetailIdValue.text = device.deviceId</span>
<span class="nc" id="L164">            deviceDetailTypeValue.text = device.deviceType</span>
<span class="nc" id="L165">            deviceDetailNameValue.text = device.deviceName</span>
<span class="nc" id="L166">            deviceDetailModelValue.text = device.model</span>
<span class="nc" id="L167">            deviceDetailManufacturerValue.text = device.manufacturer</span>
<span class="nc" id="L168">            deviceDetailIdentificationIdValue.text = device.identificationId</span>
<span class="nc" id="L169">            deviceDetailDescValue.text = device.otherDetails</span>
<span class="nc" id="L170">        }</span>
<span class="nc" id="L171">    }</span>

    private fun shrinkFab() {

<span class="nc" id="L175">        binding.mainFabBtn.startAnimation(rotateAntiClockWiseFabAnim)</span>
<span class="nc" id="L176">        binding.deviceDetailEditBtn.startAnimation(toBottomFabAnim)</span>
<span class="nc" id="L177">        binding.deviceDetailDeleteBtn.startAnimation(toBottomFabAnim)</span>

<span class="nc bnc" id="L179" title="All 2 branches missed.">        isExpanded = !isExpanded</span>

<span class="nc" id="L181">        binding.mainFabBtn.setImageResource(R.drawable.baseline_add_circle_24)</span>

<span class="nc" id="L183">    }</span>

    private fun expandFab() {


<span class="nc" id="L188">        binding.deviceDetailEditBtn.startAnimation(fromBottomFabAnim)</span>
<span class="nc" id="L189">        binding.deviceDetailDeleteBtn.startAnimation(fromBottomFabAnim)</span>

<span class="nc bnc" id="L191" title="All 2 branches missed.">        isExpanded = !isExpanded</span>
<span class="nc" id="L192">        binding.mainFabBtn.setImageResource(R.drawable.baseline_close_24)</span>


<span class="nc" id="L195">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>