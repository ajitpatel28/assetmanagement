<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HomeFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DeviceViewModelTest (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.ajit.devicemanagement.ui.home</a> &gt; <span class="el_source">HomeFragment.kt</span></div><h1>HomeFragment.kt</h1><pre class="source lang-java linenums">package com.ajit.devicemanagement.ui.home

import android.content.Context
import android.graphics.drawable.BitmapDrawable
import android.os.Bundle
import androidx.fragment.app.Fragment
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.view.WindowManager
import androidx.activity.OnBackPressedCallback
import androidx.appcompat.widget.SearchView
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.ajit.devicemanagement.R
import com.ajit.devicemanagement.data.provider.DataSyncManager
import com.ajit.devicemanagement.databinding.FragmentHomeBinding
import com.ajit.devicemanagement.ui.auth.LoginFragment
import com.ajit.devicemanagement.ui.device.DeviceListingAdapter
import com.ajit.devicemanagement.ui.device.DeviceViewModel
import com.ajit.devicemanagement.util.*
import com.ajit.devicemanagement.util.ImageUtils.saveImageLocally
import dagger.hilt.android.AndroidEntryPoint


@AndroidEntryPoint
<span class="nc" id="L28">class HomeFragment : Fragment() {</span>

<span class="nc bnc" id="L30" title="All 2 branches missed.">    lateinit var binding: FragmentHomeBinding</span>
    private lateinit var searchView: SearchView
<span class="nc" id="L32">    private val viewModel:DeviceViewModel by viewModels()</span>
    private lateinit var dataSyncManager: DataSyncManager
<span class="nc" id="L34">    private val currentUser = LoginFragment.UserSession.loggedInUser</span>


<span class="nc" id="L37">    private val adapter by lazy {</span>
<span class="nc" id="L38">        HomeDeviceListingAdapter(</span>
<span class="nc" id="L39">            onItemClicked = { pos, item -&gt;</span>
<span class="nc" id="L40">                findNavController().navigate(</span>
<span class="nc" id="L41">                    R.id.action_homeFragment_to_deviceDetailFragment,</span>
<span class="nc" id="L42">                    Bundle().apply {</span>
<span class="nc" id="L43">                        putParcelable(&quot;device&quot;, item)</span>
<span class="nc" id="L44">                    }</span>
                )
<span class="nc" id="L46">            }</span>
        )
    }


    override fun onAttach(context: Context) {
<span class="nc" id="L52">        super.onAttach(context)</span>
<span class="nc" id="L53">        dataSyncManager = DataSyncManager(requireContext())</span>
<span class="nc" id="L54">    }</span>

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
<span class="nc" id="L60">        binding = FragmentHomeBinding.inflate(layoutInflater)</span>

<span class="nc" id="L62">        return binding.root</span>
    }


    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L67">        super.onViewCreated(view, savedInstanceState)</span>


<span class="nc" id="L70">        loadData()</span>
<span class="nc" id="L71">        binding.homeRecyclerView.layoutManager = LinearLayoutManager(requireContext(),LinearLayoutManager.HORIZONTAL,false)</span>

<span class="nc" id="L73">        binding.homeRecyclerView.adapter = adapter</span>

<span class="nc" id="L75">        binding.noDevicesFound.visibility = View.GONE</span>

<span class="nc" id="L77">        binding.addDeviceButton.setOnClickListener {</span>
<span class="nc" id="L78">            findNavController().navigate(R.id.action_homeFragment_to_addNewDeviceFragment)</span>
<span class="nc" id="L79">        }</span>

<span class="nc" id="L81">        binding.homeBtn.setOnClickListener {</span>
<span class="nc" id="L82">            findNavController().navigate(R.id.action_homeFragment_self2)</span>
<span class="nc" id="L83">        }</span>

<span class="nc" id="L85">        binding.userProfile.setOnClickListener {</span>
<span class="nc" id="L86">            findNavController().navigate(R.id.action_homeFragment_to_userProfileFragment)</span>
<span class="nc" id="L87">        }</span>


<span class="nc" id="L90">        binding.myDevices.setOnClickListener {</span>
<span class="nc" id="L91">            findNavController().navigate(R.id.action_homeFragment_to_deviceListingFragment)</span>

<span class="nc" id="L93">        }</span>

<span class="nc" id="L95">        binding.viewAllDevices.setOnClickListener {</span>
<span class="nc" id="L96">            findNavController().navigate(R.id.action_homeFragment_to_deviceListingFragment)</span>

<span class="nc" id="L98">        }</span>

<span class="nc" id="L100">        binding.apply {</span>

<span class="nc bnc" id="L102" title="All 2 branches missed.">            currentUser?.let {</span>
<span class="nc" id="L103">                nametextView.text = &quot;Hi, ${it.name}&quot;</span>
<span class="nc" id="L104">                ImageUtils.loadImageLocally(requireContext(), it.id, profileimageView)</span>
<span class="nc" id="L105">            }</span>
<span class="nc" id="L106">        }</span>




<span class="nc" id="L111">        searchView = binding.searchView</span>

<span class="nc" id="L113">        binding.searchView.setOnClickListener {</span>
<span class="nc" id="L114">            findNavController().navigate(R.id.action_homeFragment_to_deviceListingFragment)</span>
<span class="nc" id="L115">        }</span>


<span class="nc" id="L118">        binding.searchView.setOnQueryTextListener(object : SearchView.OnQueryTextListener {</span>
            override fun onQueryTextSubmit(query: String?): Boolean {
<span class="nc" id="L120">                navigateToDeviceListingFragment(query)</span>
<span class="nc" id="L121">                return true</span>
            }

            override fun onQueryTextChange(newText: String?): Boolean {
<span class="nc" id="L125">                navigateToDeviceListingFragment(newText)</span>
<span class="nc" id="L126">                return true</span>
            }

        })


<span class="nc" id="L132">        val onBackPressedCallback = object : OnBackPressedCallback(true) {</span>
            override fun handleOnBackPressed() {
<span class="nc" id="L134">                requireActivity().finish() // Close the app</span>
<span class="nc" id="L135">            }</span>
        }

        // Add the BackPressedCallback to the OnBackPressedDispatcher
<span class="nc" id="L139">        requireActivity().onBackPressedDispatcher.addCallback(viewLifecycleOwner, onBackPressedCallback)</span>
<span class="nc" id="L140">    }</span>


    private fun navigateToDeviceListingFragment(query: String?) {
<span class="nc" id="L144">        findNavController().navigate(R.id.action_homeFragment_to_deviceListingFragment,Bundle().apply {</span>
<span class="nc" id="L145">            putString(&quot;searchQuery&quot;,query)</span>
<span class="nc" id="L146">        })</span>
<span class="nc" id="L147">    }</span>

    private fun loadData(){
<span class="nc" id="L150">        viewModel.getDevices()</span>
<span class="nc" id="L151">        viewModel.devices.observe(viewLifecycleOwner) { state -&gt;</span>
<span class="nc" id="L152">            when (state) {</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                is UiState.Loading -&gt; {</span>
<span class="nc" id="L154">                    binding.progressBar.show()</span>
                }
<span class="nc bnc" id="L156" title="All 2 branches missed.">                is UiState.Failure -&gt; {</span>
<span class="nc" id="L157">                    binding.progressBar.hide()</span>
<span class="nc" id="L158">                    toast(state.error)</span>
                }
<span class="nc bnc" id="L160" title="All 2 branches missed.">                is UiState.Success -&gt; {</span>
<span class="nc" id="L161">                    binding.progressBar.hide()</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">                    if (state.data.isEmpty()) {</span>
<span class="nc" id="L163">                        binding.noDevicesFound.visibility = View.VISIBLE</span>
<span class="nc" id="L164">                        adapter.updateList(state.data.toMutableList())</span>
                    } else {
<span class="nc" id="L166">                        binding.noDevicesFound.visibility = View.GONE</span>
<span class="nc" id="L167">                        adapter.updateList(state.data.toMutableList())</span>
                    }
                }
                else -&gt; {}
            }
<span class="nc" id="L172">        }</span>
<span class="nc" id="L173">    }</span>


    override fun onResume() {
<span class="nc" id="L177">        super.onResume()</span>

<span class="nc bnc" id="L179" title="All 4 branches missed.">        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_NOTHING)</span>
<span class="nc" id="L180">        loadData()</span>

<span class="nc" id="L182">    }</span>

    override fun onPause() {
<span class="nc" id="L185">        super.onPause()</span>

        // Restore the original soft input mode when the fragment is paused
<span class="nc bnc" id="L188" title="All 4 branches missed.">        activity?.window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE)</span>
<span class="nc" id="L189">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>