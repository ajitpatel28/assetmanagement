<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserProfileFragment.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">DeviceViewModelTest (1) Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.ajit.devicemanagement.ui.user</a> &gt; <span class="el_source">UserProfileFragment.kt</span></div><h1>UserProfileFragment.kt</h1><pre class="source lang-java linenums">package com.ajit.devicemanagement.ui.user

import android.app.Activity
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.provider.MediaStore
import android.util.Log
import androidx.fragment.app.Fragment
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.activity.addCallback
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import com.ajit.devicemanagement.R
import com.ajit.devicemanagement.ui.device.DeviceViewModel
import com.ajit.devicemanagement.databinding.FragmentUserProfileBinding
import com.ajit.devicemanagement.ui.auth.AuthViewModel
import com.ajit.devicemanagement.ui.auth.LoginFragment
import com.ajit.devicemanagement.util.*
import dagger.hilt.android.AndroidEntryPoint


@AndroidEntryPoint
<span class="nc" id="L26">class UserProfileFragment : Fragment() {</span>


<span class="nc bnc" id="L29" title="All 2 branches missed.">    lateinit var binding: FragmentUserProfileBinding</span>
<span class="nc" id="L30">    private val authViewModel: AuthViewModel by viewModels()</span>
<span class="nc" id="L31">    private val deviceViewModel: DeviceViewModel by viewModels()</span>
<span class="nc" id="L32">    private val PICK_IMAGE_REQUEST = 1</span>


<span class="nc" id="L35">    private val currentUser = LoginFragment.UserSession.loggedInUser</span>



    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        // Inflate the layout for this fragment
<span class="nc" id="L44">        binding = FragmentUserProfileBinding.inflate(layoutInflater)</span>
<span class="nc" id="L45">        return binding.root</span>
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<span class="nc" id="L49">        super.onViewCreated(view, savedInstanceState)</span>


<span class="nc" id="L52">        requireActivity().onBackPressedDispatcher.addCallback(viewLifecycleOwner) {</span>
<span class="nc" id="L53">            findNavController().navigate(R.id.action_userProfileFragment_to_homeFragment)</span>
<span class="nc" id="L54">        }</span>

<span class="nc" id="L56">        binding.addDeviceButton.setOnClickListener {</span>
<span class="nc" id="L57">            findNavController().navigate(R.id.action_userProfileFragment_to_addNewDeviceFragment)</span>
<span class="nc" id="L58">        }</span>

<span class="nc" id="L60">        binding.homeBtn.setOnClickListener {</span>
<span class="nc" id="L61">            findNavController().navigate(R.id.action_userProfileFragment_to_homeFragment)</span>
<span class="nc" id="L62">        }</span>

<span class="nc" id="L64">        binding.myDevices.setOnClickListener {</span>
<span class="nc" id="L65">            findNavController().navigate(R.id.action_userProfileFragment_to_deviceListingFragment)</span>

<span class="nc" id="L67">        }</span>

<span class="nc" id="L69">        binding.profileDetailBack.setOnClickListener {</span>
<span class="nc" id="L70">            findNavController().navigate(R.id.action_userProfileFragment_to_homeFragment)</span>
<span class="nc" id="L71">        }</span>



<span class="nc" id="L75">        binding.userProfileEditBtn.setOnClickListener {</span>
<span class="nc" id="L76">            openGallery()</span>
<span class="nc" id="L77">        }</span>



<span class="nc" id="L81">        binding.apply {</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">            currentUser?.let {</span>
<span class="nc" id="L83">                titleName.text = it.name</span>
<span class="nc" id="L84">                profileName.text = it.name</span>
<span class="nc" id="L85">                titleEmployeeId.text = it.employeeId</span>
<span class="nc" id="L86">                detailEmployeeIdValue.text = it.employeeId</span>
<span class="nc" id="L87">                profileEmail.text = it.email</span>
<span class="nc" id="L88">                profileMobile.text = it.mobileNumber</span>
<span class="nc" id="L89">                ImageUtils.loadImageLocally(requireContext(), it.id, userProfile)</span>


<span class="nc" id="L92">            }</span>
<span class="nc" id="L93">        }</span>

<span class="nc" id="L95">        binding.deviceDetailEditBtn.setOnClickListener {</span>
<span class="nc" id="L96">            findNavController().navigate(R.id.action_userProfileFragment_to_userProfileEditFragment)</span>
<span class="nc" id="L97">        }</span>



<span class="nc" id="L101">        binding.logout.setOnClickListener {</span>
<span class="nc" id="L102">            authViewModel.logout {</span>
<span class="nc" id="L103">                deviceViewModel.deleteAllDevices()</span>
<span class="nc" id="L104">                findNavController().navigate(R.id.action_userProfileFragment_to_loginFragment)</span>
<span class="nc" id="L105">            }</span>
<span class="nc" id="L106">        }</span>
<span class="nc" id="L107">    }</span>

    private fun openGallery() {
<span class="nc" id="L110">        val intent =</span>
<span class="nc" id="L111">            Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI)</span>
<span class="nc" id="L112">        startActivityForResult(intent, PICK_IMAGE_REQUEST)</span>
<span class="nc" id="L113">    }</span>




    @Deprecated(&quot;Deprecated in Java&quot;)
    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
<span class="nc" id="L120">        super.onActivityResult(requestCode, resultCode, data)</span>

<span class="nc bnc" id="L122" title="All 6 branches missed.">        if (requestCode == PICK_IMAGE_REQUEST &amp;&amp; resultCode == Activity.RESULT_OK &amp;&amp; data != null) {</span>
<span class="nc" id="L123">            val selectedImage: Uri? = data.data</span>
<span class="nc" id="L124">            val bitmap = MediaStore.Images.Media.getBitmap(requireContext().contentResolver, selectedImage)</span>
<span class="nc" id="L125">            binding.userProfile.setImageBitmap(bitmap)</span>


<span class="nc" id="L128">            val currentUser = LoginFragment.UserSession.loggedInUser</span>
<span class="nc bnc" id="L129" title="All 4 branches missed.">            val userId = currentUser?.id ?: &quot;&quot;</span>

<span class="nc" id="L131">            authViewModel.updateProfilePicture(userId, selectedImage!!) { state -&gt;</span>
<span class="nc" id="L132">                when (state) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                    is UiState.Success -&gt; {</span>
<span class="nc" id="L134">                        binding.progressBar.hide()</span>
<span class="nc" id="L135">                        ImageUtils.saveImageLocally(requireContext(), bitmap, userId)</span>
<span class="nc" id="L136">                        toast(&quot;Profile picture updated successfully.&quot;)</span>
                    }
<span class="nc bnc" id="L138" title="All 2 branches missed.">                    is UiState.Failure -&gt; {</span>
<span class="nc" id="L139">                        binding.progressBar.hide()</span>
<span class="nc" id="L140">                        toast(&quot;Failed to update profile picture.&quot;)</span>
                    }
<span class="nc bnc" id="L142" title="All 2 branches missed.">                    is UiState.Loading -&gt; {</span>
<span class="nc" id="L143">                        binding.progressBar.show()</span>
                    }
                }
<span class="nc" id="L146">            }</span>
        }
<span class="nc" id="L148">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>